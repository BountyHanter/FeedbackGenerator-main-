{% for review in reviews %}
<!-- Карточка отзыва -->
<div class="review-card mb-4" data-review-id="{{ review.id }}">
    <div class="review-header d-flex align-items-center mb-3">
        <!-- Информация о пользователе -->
        <div class="user-info">
            <div class="d-flex align-items-center">
                <h5 class="mb-0 text-white">{{ review.name }}</h5>
                <span class="badge bg-success ms-2">2GIS</span>
            </div>
            <small>{{ review.formatedDateCreated|date:"j E Y" }}</small>
            <input type="hidden" name="dateCreated" value="{{ review.dateCreated}}">
        </div>
        <!-- Рейтинг -->
        <div class="ms-auto rating-stars">
            <!-- Звёздный рейтинг -->
            {% for star in review.rating %}
                <span class="star">&#9733;</span>
            {% endfor %}
        </div>
    </div>
    <!-- Фотографии отзыва -->
    {% if review.photos %}
        <div class="review-photos mb-3">
            {% for photo in review.photos %}
                <img src="{{ photo }}" alt="Фото отзыва" class="me-2 img-thumbnail" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#imageModal" onclick="openImageModal('{{ photo }}')">
            {% endfor %}
        </div>
    {% endif %}
    <!-- Текст отзыва -->
    <div class="review-text">
        <p id="review-text-{{ review.id }}"
           data-full-text="{{ review.text }}"
           data-short-text="{{ review.text|truncatechars:200 }}">
           {{ review.text|truncatechars:200 }}
        </p>
        {% if review.text|length > 200 %}
            <a href="#" id="read-more-{{ review.id }}" class="text-primary" onclick="toggleReviewText(event, {{ review.id }})">Читать далее</a>
        {% endif %}
    </div>
    <!-- Подвал карточки -->
    <div class="review-footer mt-3">
        <div class="d-flex justify-content-between align-items-center">
            <!-- Кнопка "Ответить" -->
            <div>
                <button class="btn btn-outline-light btn-sm" style="margin-right: 10px;" onclick="toggleReplyPanel(this)">Ответить</button>
                <a> {{ review.commentsCount }} </a>
            </div>
            <!-- Темы -->
            <div class="d-flex align-items-center">
                <div class="themes me-3">
                    <span> Темы: [Пока не настроено]</span>
                </div>
                <!-- Лайки -->
                {% if review.likesCount > 0 %}
                <div class="likes me-3">
                    <svg width="18" height="18" fill="currentColor" class="me-1" xmlns="http://www.w3.org/2000/svg">
                        <!-- Иконка лайка -->
                        <path d="M11.093 1a1 1 0 01.993.878l.007.116.022 3.993h4.777a1 1 0 01.998 1.067l-.015.117-1.5 8.046a2.002 2.002 0 01-1.986 1.633l-.153-.007-9.893-.857-3.394-.004c-.485-.057-.748-.439-.816-.82l-.014-.104-.003-.061L.1 7.819c.04-.445.4-.777.835-.826l.11-.006H5.1a21.712 21.712 0 002.055-2.976 16.91 16.91 0 001.2-2.579L8.504 1h2.59-.001zm-.995 2h-.214l-.033.08c-.208.484-.44.964-.694 1.442l-.263.477c-.534.94-1.16 1.87-1.877 2.791l-.366.46-.551.675v5.205l8.309.72 1.279-6.864h-5.563l-.027-4.987V3zM4.063 8.987H2.106l.01 3.687-.001 1.31 1.977.003.008-.84v-.496l-.005-.869-.032-2.795z" fill="currentColor"></path>
                    </svg>
                    <span>{{ review.likesCount }}</span>
                </div>
                {% endif %}
                <div style="position: relative; display: inline-block; margin-right: 10px;">
                    <button style="background-color: transparent; border: none; padding: 0; cursor: pointer; position: relative;"
                            onclick=" openComplaintModal({{ review.id }})">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="16" style="position: relative; z-index: 1;">
                            <g fill="none" fill-rule="evenodd">
                                <path class="icon-border" stroke="white" stroke-width="2" d="M9.775 2.8c.25-.058.52-.02.755.126h0l6.71 10.544a1 1 0 01-.848 1.53h0H3.608a.997.997 0 01-1-1c0-.187.053-.371.152-.53h0L9.152 3.244a.996.996 0 01.623-.445z"></path>
                                <circle cx="10" cy="12" r="1" fill="white"></circle>
                                <rect width="2" height="3" x="9" y="7" fill="white" rx="1"></rect>
                            </g>
                        </svg>
                    </button>
                    <!-- Надпись -->
                    <div class="tooltip">Пожаловаться на отзыв</div>
                </div>
                <div style="position: relative; display: inline-block;">
                    <button
                        class="favorite-btn"
                        data-review-id="{{ review.id }}"
                        style="background-color: {% if review.is_favorite %}#bfbf93{% else %}transparent{% endif %}; border: none; padding: 0; cursor: pointer; position: relative;"
                        onclick="toggleFavorite(event)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="16" style="position: relative; z-index: 1;">
                            <g fill="none" fill-rule="evenodd">
                                <path class="icon-border" stroke="white" stroke-width="2" d="M7 2h6a1 1 0 0 1 .8 1.6l-2 2.4 2 2.4A1 1 0 0 1 13 10H7v6H5V2h2z"></path>
                            </g>
                        </svg>
                    </button>
                    <div class="tooltip">
                        {% if review.is_favorite %}Удалить из избранного{% else %}Добавить в избранное{% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Панель ответа -->
        <div class="reply-panel mt-3" style="display: none;">
            <textarea class="form-control mb-2" rows="3" placeholder="Напишите ваш ответ..."></textarea>
            <div class="d-flex justify-content-end">
                <button class="btn btn-secondary me-2">Сгенерировать ответ</button>
                <button class="btn btn-primary" onclick="sendReply(event, {{ review.id }})">Отправить</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<!-- Кнопка "Загрузить еще" -->
{% if lastReview %}
<div class="text-center mt-4">
    <button id="load-more-btn" class="btn btn-outline-light"
            data-offset-date="{{ lastReview.dateCreated }}"
            data-filial-id="{{ filial_id }}"
            onclick="loadMoreReviews(event)">Загрузить еще</button>
</div>
{% endif %}

