# Архитектура проекта

Этот раздел описывает текущее устройство системы, взаимодействие её компонентов и используемые технологии. Он необходим для понимания логики работы сервиса.

### **Структура микросервисов**

На данный момент система включает в себя следующие микросервисы:

1. **Основной сервис (Django)**  
      - Реализует авторизацию и хранение данных пользователей.
      - Управляет связью с микросервисами.
      - Обрабатывает запросы от пользователей (через API или веб-интерфейс).

2. **Микросервис 2ГИС (FastAPI)**  
      - Авторизуется в 2ГИС с учётом антибот-защиты.
      - Собирает отзывы и отправляет их в основной сервис.
      - Передаёт отзывы микросервису ChatGPT для генерации ответа.
      - Публикует сформированные ответы на 2ГИС.

3. **Микросервис Флампа (FastAPI)**  
      - Аналогичен микросервису 2ГИС, но работает с платформой Фламп.
   
4. **Микросервис парсинга отзывов (FastAPI + Redis + Celery) (Реализован скрипт но не полноценный микросервис)**  
      - Централизованный сервис для сбора отзывов с разных платформ.
      - Работает с очередями сообщений (Redis).
      - Обрабатывает запросы на парсинг и периодически выполняет сбор отзывов.

5. **Микросервис ChatGPT (FastAPI) (Не реализован)**  
      - Принимает запросы на генерацию ответов.
      - Извлекает данные из базы о предпочтениях пользователя.
      - Генерирует текст ответа с помощью ChatGPT.
      - Передаёт готовый ответ в основной сервис.

В будущем планируется добавить аналогичные микросервисы для других платформ (Zoon, Яндекс, Google и т. д.).

### **Взаимодействие микросервисов**

На данный момент микросервисы взаимодействуют друг с другом посредством HTTP-запросов. 

Основной сценарий взаимодействия микросервисов:

1. Основной сервис инициирует процесс сбора отзывов, отправляя запрос в **микросервис парсинга отзывов**.
2. Микросервис парсинга обращается к соответствующему **микросервису площадки** (например, 2ГИС или Флампа).
3. Полученные отзывы отправляются в **микросервис ChatGPT** для генерации ответов.
4. Готовые ответы возвращаются в **микросервис площадки**, который публикует их.
5. Основной сервис фиксирует все данные в базе и передаёт их в веб-интерфейс.

### **Используемые технологии**

В проекте применяются следующие технологии:

- **Django** — основной сервис (авторизация, управление пользователями, API).
- **FastAPI** — микросервисы (2ГИС, Фламп, парсинг, генерация ответов).
- **PostgreSQL** — основная база данных.
- **SQLite** — используется на этапе разработки.
- **Redis** — хранение временных данных, работа с очередями сообщений.
- **Celery** — асинхронные задачи (парсинг отзывов).

### **Коммуникация между микросервисами**

| Компонент              | Взаимодействие                         |
|------------------------|---------------------------------------|
| Основной сервис       | HTTP-запросы к микросервисам          |
| Микросервис 2ГИС      | HTTP-запросы к платформе 2ГИС        |
| Микросервис Флампа    | HTTP-запросы к платформе Фламп       |
| Микросервис ChatGPT   | Получение данных по HTTP             |
| Микросервис парсинга  | Обрабатывает задачи через Celery     |
| Redis                 | Очереди сообщений для асинхронных задач |
| PostgreSQL            | Основное хранилище данных            |

